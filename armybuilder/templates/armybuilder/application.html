{% load staticfiles %}

<!DOCTYPE html>
<html lang="eng">
    <head>
        <meta charset="utf=8">
        <title>Army Builder</title>
        <link rel="stylesheet" type="text/css" href="{% static "armybuilder/styles/armybuilder.css" %}" media="screen" />
        <script src="{% static "armybuilder/scripts/jquery-2.2.3.js" %}"></script>
        <script src="{% static "armybuilder/scripts/jsrender.js" %}"></script>
        <script src="{% static "armybuilder/scripts/armybuilder-controller.js" %}"></script>
        <script src="{% static "armybuilder/scripts/armybuilder-webstorage.js" %}"></script>
    </head>

    <body>
        <header>
            Torkel's Army Builder
        </header>
        <main id="armybuilderPage">
            <div id="armySelectionPanel"></div>
            <div id="leftPanel">
                <div id="leftPanelHeader">
                    <div id="forceListHeader">
                        <button class="forceListReturnBtn">- <span>Army Title</span></button>
                        <button class="forceSectionBtn" data-section="unitList">Units</button>
                        <button class="forceSectionBtn" data-section="monList">Monsters &<br>Warengines</button>
                        <button class="forceSectionBtn" data-section="heroList">Heroes</button>
                    </div>
                </div>
                <div id="leftPanelBody"></div>
                <div id="leftPanelFooter"></div>
            </div>
            <div id="rightPanel">
                <table id="choiceList">
                    <caption>
                        <span id="armylistTitle">Army List</span>
                    </caption>
                    <colgroup>
                        <col width="45%">
                        <col width="45%">
                        <col width="10%">
                    </colgroup>
                    <tbody id="choiceListBody">
                    </tbody>
                    <tfoot>
                        <td>Points total:</td>
                        <td><span id="pointsTotal">0</span></td>
                    </tfoot>
                </table>
            <span id="armylistDetails">
                <button id="primaryArmyBtn">Army type</button>
                <ul id="primaryArmyOptions"></ul>
            </span>
            <span>
                <button class="pdfBtn">PDF</button>
                <table id="statsTable"></table>
            </span>
            </div>
        </main>
        <footer>
        </footer>
    </body>

    <script>
$(document).ready(function() {
    armybuilderController.init($('#armybuilderPage'), function(army) {
            armybuilderController.loadForceListJSON();
    });
});
    </script>

    <script id="forceListTmpl" type="text/x-jsrender">
<table id="unitList" data-army={?>key?} class="forceList">
    <thead>
        <th class="unitName"></th>
        <th>Troop</th>
        <th>Regiment</th>
        <th>Horde</th>
        <th>Legion</th>
    </thead>
    <tbody>
    {?props units?}
        {?if ~isUnit(prop)?}
            <tr>
                <td class="unitName">{?>prop.name?}</td>
                {?include ~form="Troop" tmpl="#btnTmpl"/?}
                {?include ~form="Regiment" tmpl="#btnTmpl"/?}
                {?include ~form="Horde" tmpl="#btnTmpl"/?}
                {?include ~form="Legion" tmpl="#btnTmpl"/?}
            </tr>
        {?/if?}
    {?/props?}
    </tbody>
</table>
<table id="monList" data-army={?>key?} class="forceList nodisplay">
    <thead>
        <th class="unitName"></th>
        <th>Monster</th>
        <th>War Engine</th>
    </thead>
    <tbody>
    {?props units?}
        {?if ~isMon(prop)?}
            <tr>
                <td class="unitName">{?>prop.name?}</td>
                {?include ~form="Monster" tmpl="#btnTmpl"/?}
                {?include ~form="Warengine" tmpl="#btnTmpl"/?}
            </tr>
        {?/if?}
    {?/props?}
    </tbody>
</table>
<table id="heroList" data-army={?>key?} class="forceList nodisplay">
    <thead>
        <th class="unitName"></th>
        <th>Hero</th>
    </thead>
    <tbody>
    {?props units?}
        {?if ~isHero(prop)?}
            <tr>
                <td class="unitName">{?>prop.name?}</td>
                {?include ~form="Hero" tmpl="#btnTmpl"/?}
            </tr>
        {?/if?}
    {?/props?}
    </tbody>
</table>
    </script>

    <script id="btnTmpl" type="text/x-jsrender">
    {?if prop[~form]?}
    <td><nav><a href="#" class="unitBtn" data-key={?>key?} data-form={?:~form?}>{?>prop[~form].Pts?}</a></nav></td>
    {?else?}
    <td><nav><a href="#" class="emptyBtn" >-</a></nav></td>
    {?/if?}
    </script>

    <script id="armySelectionPanelTmpl" type="text/x-jsrender">
<span><a href="#" class="armyBtn" data-army={?:key?}>{?:name?}</a></span>
    </script>

    <script id="listTitleTmpl" type="text/x-jsrender">
<textarea rows="1" cols="30" maxlength="30" id="titleChange" data-old-value="{?:value?}" onblur="{?:func?}()" onkeydown="if(event.keyCode==13){?:func?}()">{?:value?}</textarea>
    </script>

    <script id="primaryArmyTmpl" type="text/x-jsrender">
<li><a href="#" data-army={?:key?}>{?:name?}</a></li>
    </script>

    <script id="unitChoiceTmpl" type="text/x-jsrender">
    <tr data-unit-id={?:id?}>
        <td class="unitName">{?:name?}{?:~suffix(form)?}</td>
        <td>{?include stats tmpl="#unitStatsTmpl"/?}</td>
        <td><nav><a href="#" class="removeBtn">X</a></nav></td>
    </tr>
    </script>

    <script id="unitStatsTmpl" type="text/x-jsrender">
    <table class="unitStats">
        <thead>
            <th>Sp</th>
            <th>Me</th>
            <th>Ra</th>
            <th>De</th>
            <th>Att</th>
            <th>Ne</th>
            <th>Pts</th>
        </thead>
        <tbody>
            <td>{?>Sp?}</td>
            <td>{?>Me?}</td>
            <td>{?>Ra?}</td>
            <td>{?>De?}</td>
            <td>{?>Att?}</td>
            <td>{?>Ne?}</td>
            <td>{?>Pts?}</td>
        </tbody>
    </table>
    </script>

    <script id="statsTmpl" type="text/x-jsrender">
    <tr><td>Total number of units: {?:count?}</td></tr>
    <tr><td>{?:Horde?} Hordes, {?:Legion?} Legions</td></tr>
    <tr><td>{?:Regiment?} Regiments</td></tr>
    <tr><td legal="{?:legalTro?}">{?:Troop?} Troops ({?:slotsTro?} slots left)</td></tr>
    <tr><td legal="{?:legalHer?}">{?:Hero?} Heroes ({?:slotsHer?} slots left)</td></tr>
    <tr><td legal="{?:legalMon?}">{?:Monster?} Monsters ({?:slotsMon?} slots left)</td></tr>
    <tr><td legal="{?:legalWen?}">{?:Warengine?} War Engines ({?:slotsWen?} slots left)</td></tr>
    <tr><td legal="{?:legalAllies?}">{?:allies?}% Allies</td></tr>
    </script>
</html>

