{% load staticfiles %}

<!DOCTYPE html>
<html lang="eng">
    <head>
        <meta charset="utf=8">
        <title>Army Builder</title>
        <link rel="stylesheet" type="text/css" href="{% static "armybuilder/styles/armybuilder.css" %}" media="screen" />
        <script src="{% static "armybuilder/scripts/jquery-2.2.3.js" %}"></script>
        <script src="{% static "armybuilder/scripts/jsrender.js" %}"></script>
        <script src="{% static "armybuilder/scripts/armybuilder-controller.js" %}"></script>
        <script src="{% static "armybuilder/scripts/armybuilder-webstorage.js" %}"></script>
    </head>

    <body>
        <header>
            Torkel's Army Builder
        </header>
        <main id="armybuilderPage">
            <div id="leftPanel">
                <div id="leftPanelHeader">
                    <div id="forceListHeader">
                        <div class="forceListReturnBtn"><div class="buttonWrapper"><div>Select an army</div></div></div>
                        <div class="forceSectionBtn" data-section="unitList"><div class="buttonWrapper"><div>Units</div></div></div>
                        <div class="forceSectionBtn" data-section="monList"><div class="buttonWrapper"><div>Monsters & Warengines</div></div></div>
                        <div class="forceSectionBtn" data-section="heroList"><div class="buttonWrapper"><div>Heroes</div></div></div>
                    </div>
                </div>
                <div id="leftPanelBody">
                    <div id="armyChoicePanel"></div>
                    <div id="unitChoicePanel"></div>
                </div>
                <div id="leftPanelFooter"></div>
            </div>
            <div id="rightPanel">
                <div id="rightPanelHeader">
                    <div id="armylistTitle" class="rightHeaderField">
                        <div>Army List</div>
                        <textarea id="titleChange" style="display:none;" rows="1" cols="30" maxlength="30"></textarea>
                    </div>
                    <div class="rightHeaderField">
                        <button id="primaryArmyBtn" class="dropdownBtn"></button>
                        <ul id="primaryArmyOptions" class="dropdownMenu"></ul>
                    </div>
                    <div class="rightHeaderField">
                        <button id="armylistPoints" class="dropdownBtn"></button>
                        <ul id="armylistPointsOptions" class="dropdownMenu">
                            <li><a href="#">1500</a></li>
                            <li><a href="#">2000</a></li>
                            <li><a href="#">2500</a></li>
                        </ul>
                    </div>
                </div>
                <div id="rightPanelBody">
                    <table id="choiceList">
                        <colgroup>
                            <col width="45%">
                            <col width="45%">
                            <col width="10%">
                        </colgroup>
                        <tbody id="choiceListBody">
                        </tbody>
                        <tfoot>
                            <td>Points total:</td>
                            <td><span id="pointsTotal">0</span></td>
                        </tfoot>
                    </table>
                </div>
                <div id="rightPanelFooter">
                    <span>
                        <button class="pdfBtn">PDF</button>
                    </span>
                    <div id="statsTable"></div>
                </div>
            </div>
        </main>
        <footer>
        </footer>
    </body>

    <script>
$(document).ready(function() {
    armybuilderController.init($('#armybuilderPage'), function(army) {
            armybuilderController.loadForceListJSON();
    });
});
    </script>

    <script id="forceListTmpl" type="text/x-jsrender">
<table id="unitList" data-army={?>key?} class="forceList">
    <thead>
        <th class="unitName"></th>
        <th>Troop</th>
        <th>Regiment</th>
        <th>Horde</th>
        <th>Legion</th>
    </thead>
    <tbody>
    {?props units?}
        {?if ~isUnit(prop)?}
            <tr>
                <td class="unitName">{?>prop.name?}</td>
                {?include ~form="Troop" tmpl="#btnTmpl"/?}
                {?include ~form="Regiment" tmpl="#btnTmpl"/?}
                {?include ~form="Horde" tmpl="#btnTmpl"/?}
                {?include ~form="Legion" tmpl="#btnTmpl"/?}
            </tr>
        {?/if?}
    {?/props?}
    </tbody>
</table>
<table id="monList" data-army={?>key?} class="forceList">
    <thead>
        <th class="unitName"></th>
        <th>Monster</th>
        <th>War Eng</th>
    </thead>
    <tbody>
    {?props units?}
        {?if ~isMon(prop)?}
            <tr>
                <td class="unitName">{?>prop.name?}</td>
                {?include ~form="Monster" tmpl="#btnTmpl"/?}
                {?include ~form="Warengine" tmpl="#btnTmpl"/?}
            </tr>
        {?/if?}
    {?/props?}
    </tbody>
</table>
<table id="heroList" data-army={?>key?} class="forceList">
    <thead>
        <th class="unitName"></th>
        <th>Hero</th>
    </thead>
    <tbody>
    {?props units?}
        {?if ~isHero(prop)?}
            <tr>
                <td class="unitName">{?>prop.name?}</td>
                {?include ~form="Hero" tmpl="#btnTmpl"/?}
            </tr>
        {?/if?}
    {?/props?}
    </tbody>
</table>
<div id="topScroll" class="scroller">
</div>
<div id="botScroll" class="scroller">
</div>
    </script>

    <script id="btnTmpl" type="text/x-jsrender">
    {?if prop[~form]?}
    <td><nav><a href="#" class="unitBtn" data-key={?>key?} data-form={?:~form?}>{?>prop[~form].Pts?}</a></nav></td>
    {?else?}
    <td><nav><a href="#" class="emptyBtn" >-</a></nav></td>
    {?/if?}
    </script>

    <script id="armyChoicePanelTmpl" type="text/x-jsrender">
<div class="armyBtn" data-army={?:key?}><div class="buttonWrapper"><div>{?:name?}</div></div></div>
    </script>

    <script id="primaryArmyTmpl" type="text/x-jsrender">
<li><a href="#" data-army={?:key?}>{?:name?}</a></li>
    </script>

    <script id="unitChoiceTmpl" type="text/x-jsrender">
    <tr data-unit-id={?:id?}>
        <td class="unitName">{?:name?}{?:~suffix(form)?}</td>
        <td>{?include stats tmpl="#unitStatsTmpl"/?}</td>
        <td><nav><a href="#" class="removeBtn">X</a></nav></td>
    </tr>
    </script>

    <script id="unitStatsTmpl" type="text/x-jsrender">
    <table class="unitStats">
        <thead>
            <th>Sp</th>
            <th>Me</th>
            <th>Ra</th>
            <th>De</th>
            <th>Att</th>
            <th>Ne</th>
            <th>Pts</th>
        </thead>
        <tbody>
            <td>{?>Sp?}</td>
            <td>{?>Me?}</td>
            <td>{?>Ra?}</td>
            <td>{?>De?}</td>
            <td>{?>Att?}</td>
            <td>{?>Ne?}</td>
            <td>{?>Pts?}</td>
        </tbody>
    </table>
    </script>

    <script id="statsTmpl" type="text/x-jsrender">
<table>
    <thead>
        <tr><th>Total number of units: {?:count?}</th></tr>
    </thead>
    <tbody>
        <tr><td>{?:Legion?} Legions</td><td legal="{?:legalHer?}">{?:Hero?} Heroes ({?:slotsHer?} slots left)</td></tr>
        <tr><td>{?:Horde?} Hordes</td><td legal="{?:legalMon?}">{?:Monster?} Monsters ({?:slotsMon?} slots left)</td></tr>
        <tr><td>{?:Regiment?} Regiments</td><td legal="{?:legalWen?}">{?:Warengine?} War Engines ({?:slotsWen?} slots left)</td></tr>
        <tr><td legal="{?:legalTro?}">{?:Troop?} Troops ({?:slotsTro?} slots left)</td><td legal="{?:legalAllies?}">{?:allies?}% Allies</td></tr>
    </tbody>
</table>
    </script>
</html>

